{% extends "base.html" %}
{% block title %}{{pageName}}{% endblock %}
{% block content %}
      <h2> Welcome to the CTA Refinement Website </h2>
      <h2> Refiner  </h2>
         <div id="editor" style="height: 500px; width: 1000px">
         </div>
         <input type="button" value="Submit" onclick="enterText();">

         <input id="scriptFile" type="file">
         <div id="file-content" style="display: none;"></div>

         <form id="hiddenForm" hidden method="POST">
         <input id="script" name="script" type="text" >
         </form>
         <script src="../static/js/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
         <script>
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/chrome");
            editor.session.setMode("ace/mode/cta");
            editor.setShowPrintMargin(true);
            document.getElementById('editor').style.fontSize='20px';
           
            //function validateCta(cta){
            //    var ctaPattern = new RegExp('Cta [A-Za-z]\\w+ = {[\\s\\S]*};');
            //    if (ctaPattern.exec(cta)>0){
            //        return true;
            //    }
            //    else{
            //        console.log(ctaPattern.exec(cta));
            //    }
            //}


            function enterText(){
                var text = editor.getValue();
                var script = document.getElementById("script");
                script.value = text;
                console.log(script.value);
                //console.log(script.value)
                //if(validateCta(script.value)){
                document.getElementById("hiddenForm").submit();
                //}
                //else{
                //    console.log('No Beans');
               // }
            }
            
            var scriptFile = document.getElementById('scriptFile');
            scriptFile.addEventListener('change', readSingleFile, false);

            function readSingleFile(e) {
               var file = e.target.files[0];
               if (!file) {
                  return;
               }
               var reader = new FileReader();
               reader.onload = function(e) {
                  var contents = e.target.result;
                  displayContents(contents);
               };
               reader.readAsText(file);
            }

            function displayContents(contents) {
               var element = document.getElementById('file-content');
               element.innerText = contents;
               initEditor(contents);
            }

            function initEditor(text) {
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/chrome");
            editor.set
            editor.session.setMode("ace/mode/cta");
            editor.setShowPrintMargin(true);
            editor.setValue(text);
            document.getElementById('editor').style.fontSize='20px';
            }

        </script>

   {% endblock %}





